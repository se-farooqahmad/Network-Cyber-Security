import pytest
from crypto.rsa import RSA

@pytest.mark.parametrize("bit_length, p, q, expected_public_key", [
    (128, 0xfdd640fb06671ad11c80317fa3b179d7, 0xe3b8c1e9392456de3eb13b90466852e7, (102131144432918307794100194777366238817931982267692267940645104791072467570433, 65537)),
    (256, 0xe3b8c1e9392456de3eb13b9046685257bdd640fb06671ad11c80317fa3b17a7d, 0xd72a846916419f828b9d2434e465e150bd9c66b3ad3c2d6d1a3d1fa7bc89617d, (10024347126109464120510429948124944620114325589941773229214838612085498222332769079597374006640428989520257455547356649291038137587993773001796231414361097, 65537)),
    (512, 0xd72a846916419f828b9d2434e465e150bd9c66b3ad3c2d6d1a3d1fa7bc8960a923b8c1e9392456de3eb13b9046685257bdd640fb06671ad11c80317fa3b17ad7, 0xeb65a6a48b8148f6b38a088ca65ed389b74d0fb132e706298fadc1a606cb0fb39a1de644815ef6d13b8faa1837f8a88b17fc695a07a0ca6e0822e8f36c03182f, (138934628201351025216726057571546078520871216509584089168527454673469386926168828955804061402945386935226814571387802965449765733637025335771275685053314577942683652900363530141211473037703571140050320223040540929286190818328637473090587222911235218871960632258821665589021448694442403783353994198478149825913, 65537))
])
def test_generate_public_key(bit_length, p, q, expected_public_key):
    rsa = RSA(prime_bit_length=bit_length)
    rsa.set_primes(p, q)
    public_key = rsa.generate_public_key()
    assert public_key == expected_public_key

@pytest.mark.parametrize("bit_length, p, q, expected_private_key", [
    (128, 0xfdd640fb06671ad11c80317fa3b179d7, 0xe3b8c1e9392456de3eb13b90466852e7, 0xa8bfe2af68edc87a36d2eafaeaeb46a2c9fd2ce3804a7c7e5e50b1ab9902780d),
    (256, 0xe3b8c1e9392456de3eb13b9046685257bdd640fb06671ad11c80317fa3b17a7d, 0xd72a846916419f828b9d2434e465e150bd9c66b3ad3c2d6d1a3d1fa7bc89617d, 0x4d8b4c88739d8aeb98dc163e40067aec4e63e37e861cc7e6c99484494653a3f05c0aad890245141c2528018edaf5bcf271d9711c26f0fe02774ca722e80efb81),
    (512, 0xd72a846916419f828b9d2434e465e150bd9c66b3ad3c2d6d1a3d1fa7bc8960a923b8c1e9392456de3eb13b9046685257bdd640fb06671ad11c80317fa3b17ad7, 0xeb65a6a48b8148f6b38a088ca65ed389b74d0fb132e706298fadc1a606cb0fb39a1de644815ef6d13b8faa1837f8a88b17fc695a07a0ca6e0822e8f36c03182f, 0x9b7c3c068c1088ae45f7cde15a90c2a8e87df6df015fed8fb326a7a7c5207a0a91e44eae6b8302ac9322332d69e2b553c5f1c04ec24396040809ab20d39bc228dfb175ad74e65ad17822b449233696f996ad34a6ca35fe647dcddb4f27adf168bb68badde3eb2e58bbafa6fc6857e66765e9c97258cdb646f7a11357673289c1),
    (1024, 0xeb65a6a48b8148f6b38a088ca65ed389b74d0fb132e706298fadc1a606cb0fb39a1de644815ef6d13b8faa1837f8a88b17fc695a07a0ca6e0822e8f36c031199972a846916419f828b9d2434e465e150bd9c66b3ad3c2d6d1a3d1fa7bc8960a923b8c1e9392456de3eb13b9046685257bdd640fb06671ad11c80317fa3b17b5b, 0xf59cde66bacfb3d00b1f9163ce9ff57f43b7a3a69a8dca03580d7b71d8f564135be6128e18c267976142ea7d17be31111a2a73ed562b0f79c37459eef50bea63371ecd7b27cd813047229389571aa8766c307511b2b9437a28df6ec4ce4a2bbdc241330b01a9e71fde8a774bcf36d58b4737819096da1dac72ff5d2a386ed24b, 0x1575706495e4c7702f3c218ca4282cb9b5c924fae764159c925202e9c503495fc45ad5b03d1800f22bbd29adb3a02d0b5c1f89e032b9487ef9dce9dafdb3b6b0ada7e0943f434861f69158202092190cb76525d967968dad34652995eb18b082fd6553829ef7ddd779084f9012e24ccb3abc80ceb84b197d8d8c6e520fa8a690acfb2fb8fc5cec860294675e954380052dd0992b1d2d193cf529372ca676f891e03e7e85ed7b4d27b4c3ead54470d508841fec141b8afeabaf8d33d1e23bba8dd1157446b1eadfb955aa1bec732e21b348f53401df94e9e7df60c82f6794b922829094cdb8777d5e88107c6902823d9a12ae878c02dadad4037d5003f6c6954d)
])
def test_generate_private_key(bit_length, p, q, expected_private_key):
    rsa = RSA(prime_bit_length=bit_length)
    rsa.set_primes(p, q)
    public_key = rsa.generate_private_key()
    assert public_key == expected_private_key

@pytest.mark.parametrize("p, q, msg, ciphertext", [
    (0xdbe6a8ea7f8ec4c2994b7a567404359018a61865cafedacfb2ccdfa7abf10ac25eb0452176688387f59ba79924d8cea5c33f4584b23bc1d8493cd01609de88dd, 0xcec69d372d1aa9ea64d8f3636f1f16f1f362b708c15c71bfe2f234308c072307f275418cda2f966e9fdfe1685f53f26c939d61dc6eb108e2839aa6b004e77b93, "Hello, World!", 0x3649c68e5f8040c7d18a421626105ec24b217b0532c2b18b756066e1ad9e44efd489a77a4c6e2c5b1a98c7d75d752443c801b808e5475d4c1fd49b4c3d11f7b6949f164564ad66a28098030b1b6be16dac336ae253040b722ceb0838eb231361032f0be8ae87daeac34b82cd4e56590015e1a2079053d859cbeba9e277d238c9),
    (0xfa6b594e98e335286308b85bc5b5849620f2c3607ef85d5bd5a25c02832ea288291e1aa618829eed2749ac5860383fa01fe2a062d1f9effa1b784c44d9d2f647, 0xc678b59a4bd120b42a6d06f0d6cf23c00fb87e07f120986b2fc6499d0fab80c5944ae60b0c86010e10439bde607e2b462e8d0bb3933d9d81459d990181b5877f, "Test message", 0xb27dd6bafa301969ddefb28744bc57e6ad4e67cabf1e693154bb79761c96b75e13355999cf7b3e2fe441faa96bafbfaa2bdfeda4c00c0d6321f9419057cd6164bc126996754792d168a13e702097a917e36924ab71b5bc38a8233d9b4614777a8042f9162e58d83c410e90b07cb2c14d881986d32f0a348736183df8da742a62),
    (0xd84481351816da590fa0448eade3702da6561be6eecb2547a76bb9c89599bc3dd0469667db0e5e65fcfcbc361a60e0339f9f243f85b25ac313b93773e3854505, 0xd484cf3fd92e1a262057b0de2ab49ae170547e0bb37ee754aa03203287656d8e5486d49654ce7017b9307855e61f2da4a5ab4237c9715e9775198c349f6c6727, "Another test message", 0x845ba88d061aebe3cb07bd51475aaefe5d2479a74b6f0716b8e327e5e82db22555e091bc162390202d1fab701c63df5a2a30ea2cb6b552712a327a6db0bc323e91c794d387110e99006e4baf7170bb4ce9ac859c42f356aac3820481e0c7f65f733a20d437fb06cb4313c03436a9480579059e20647a782af01502329e5f0790),
    (0xe9a3d6238d4de4f9fe4c06d4f81bd0ee120287d69abf39b8ac0072c72f9e383bba711a185e38a9ff44a3f94497668966e05adc180cd32c5251cd827dc7e6ca4d, 0xc60e43ae9a1394ff6a387a4ef7702500791aa55f0a9574a76f1a311eb715e9a15c8ffa6ef489e08bba83f02ac7753887e63ce18b7eb39bc14c0897ce1d015a41, "RSA is great!", 0x71e00ba64122693b37d8e2d9b26a479b7494444cf039cdd2edef9aa35a80253dd4b5827b758ea647e118aa6affbcb314d89f0e814004b589bf6e3dde75b95e966a15300581507a7449ccb1805dec3b42975b8a26311d616921af949ba0fc54223c39f35843f5923bcf58d0d0524f45e5408adfa17d70e54d55f40ed4dba5fe0b),
    (0xecbc093c890221e8b0a84cd01be38ac14eb9d5a9ceb64bfe92f7992b277364cfbb2a90cdaa30910adf9e95261613064fa51c6d2a208d57e35badd3cc1569f799, 0xc5dccb54fd3b17a7045d845dbc0e23362043c5171fd36c9bd3fdc924fa02f585ca9c2af1e74dc2131b12d40d00a51da62585702d09b8aa4c964ee498716d79f3, "Python is awesome!", 0x88ee0cb87e0db305d0802f567f3e7e9599660149a896dfceeed8ec21bf577939659800d7ba867c8ee80caf4bb6a7313e1732323625ff24ef04a955ef258bf5f7da81d2e0f46395f9e9fe92b3a1fccb7c4ef861d4fd490aea80cdfa7724e3c0527f79024d98b70b453a1feef31a7b71332e3d8a1cb5ca2c813859fa95c3cf4afa)
])
def test_encrypt(p, q, msg, ciphertext):
    rsa = RSA(prime_bit_length=512)
    rsa.set_primes(p, q)
    rsa.generate_public_key()
    rsa.generate_private_key()

    assert rsa.encrypt(msg) == ciphertext

@pytest.mark.parametrize("p, q, msg, ciphertext", [
    (0xd6a82a951b923e0a443cdef36840ff07c4da537c1651ddae44867db30d67b3a5, 0xd73e8d77550ae8898ff41e8d8944897c610e4ad509c47055dff4948fe6b4f91f, "Hello, World!", 0x2c846b41883a45925b8896d6bc78ee79236a54e12d06dad98dabd03327c0d62898b241762e12aec3ea1765c6e92190ab602b859ae9cf42522d652cc0b56cff86),
    (0xf3a1f1315573ae2d8f9b34c95653d4bd2293202c28dfa2980d496d4bda2259b1, 0xe0edeaf1166dd683c609dcba6fafc520e7e96d54006d7b3429ed479c3ec306c1, "Test message", 0x3bea0fd0b1ba0cd205496ff699f6bff5bcfd2ebeee9789a1fe45a9ac7d725c8ba1d6393ec07ec19d5322e7b75d544869737207793c21e48227f7cadae140ffce),
    (0xda1f141b72c53633bb66ecb350c1eb4401b0366f11e374ee60aa0d3098fc47a7, 0xe81775f3ca4225f72051e671246595dfaac9912d17bf6b180b3c354de7c83645, "Another test message", 0x5beb7a64cd12a9a4e1cd26f6fe5cc837d0c71a2d999d363347c38deb218e99bdf491b1f604e9339ce471db2fc07ffd993ea8eda56b6e74c8d1f64e09cfad2ca0),
    (0xf823908d43ec1f857a17a6a492cadf506e3e43c2e94129954ab38105056fb8db, 0xfba35975cd2ee163858c2e6e57ed22d04e1ad87ec4cfbb8a096802f6d67c872d, "RSA is great!", 0x73caf28970994d9e5315706afaa4938fd5fecdf2317ee007be2ade785e88b612fed27ab40e45823a19c6818a8f97159f8a35c9db9168e05932fb0ff9055c6cda),
    (0xf5e77d4dcf30cf2d9097a70286ee6241a3858cde9be1092ed23ee3c934f4f12d, 0xef33f7088343b946a56a62c3c4ef7978e497cd2f65f2ef7603365a0850b516c3, "Python is awesome!", 0x4fc1c462019412267a8ad056d1e78ca3a38fff9843e12e003cfb568f5d213e9554d1c715a1676b579fd95517a7f59a65fb456dd032cb168f09838c54ea3b2cb5)
])
def test_decrypt(p, q, msg, ciphertext):
    rsa = RSA(prime_bit_length=256)
    rsa.set_primes(p, q)
    rsa.generate_public_key()
    rsa.generate_private_key()

    assert rsa.decrypt(ciphertext) == msg

@pytest.mark.parametrize("message", [
    ("Hello, World!"),
    ("Test message"),
    ("Another test message"),
    ("RSA is great!"),
    ("Python is awesome!")  
])
def test_encrypt_decrypt(message):
    rsa = RSA(prime_bit_length=512)
    rsa.generate_primes()
    rsa.generate_public_key()
    rsa.generate_private_key()

    assert rsa.decrypt(rsa.encrypt(message)) == message

@pytest.mark.parametrize("p, q, message, signature", [
    (0xf55d2835719afa40384e79cfd83f117e83a52df249a6b7ec49f1b6106a2caa19, 0xefbc5701a3b5fc07d36d788956c259feed4392a78d1f5291716ed94c875aa04d, "Hello, World!", 0x52856e4a47eee24d0e6ec9b006769c50f9616dff42094a7d460fc7d4bfc26d6f4838486d39fced5bc9f7c13e4b44eeff881adf09cfcfe77baa9bf278e9db083),
    (0xf2638fc0439841a97796606e8f98274be2aa8420126df3f639bd3477e668df8d, 0xe8c002181ce72dc741c090f30bb59287b1f1f7cd9f95da6f792c8716a7da231b, "Test message", 0x6199d53246170d96676ac0fb0e1ed3ab72495aace0d39360f9599a3b009526aa8007e323d1e197e06ccd4e6344cb793431eaed8f329b3b55e930bd94704b42e0),
    (0xdfeccfcbd2ea73f0af93ec30cc340ced22a2d550dbd0ce07bc997fbc8741ec35, 0xde1ec9f75dd0dfb8a702443993b0ea755e16b68d59bd96c1b0acb98823160997, "Another test message", 0x1a73663bd87d15f0ae4245ae9b15a3dd1a4a916033ba6c05a5a2990a89c86616c9b16e4c429108307a8c59de049a9c5415cf78c5196e7bbd59236f29418a0a98),
    (0xf31e5c6a65e4370d3a4257f1a29c7c97df0a3485ec0dccabfb6ef5ac3b0cb8bd, 0xdcfa53efc78f242905511342c26123bf2724a03db3186e860ccbf27779de49c3, "RSA is great!", 0xca0c4d2dde6e175ccd88ec6869d755f7500804d74469a31e26ed43aa34a564045d3bdaea0c9de8b39f3045cbd72f1f42ffba050f3c377f8f521dbfc412e37b4c),
    (0xc2164e73454603bce39693d0c3568e8e51c8ce83f7b7119340152fb9559f9b25, 0xcc1d8fade0a9b6a2f7f6c5c842b5af1512d1e5b56e1c1812bc918e372c066eb1, "Python is awesome!", 0x16b442d41cd4552ccbdc80bc43ae0d69fdff2f82afe08ce7c363832900a60bbc7d487b21c4608de509fc6941c2d487c3306038a0c78e3410c86303870f41dbd2)
])
def test_sign(p, q, message, signature):
    rsa = RSA(prime_bit_length=256)
    rsa.set_primes(p, q)
    rsa.generate_public_key()
    rsa.generate_private_key()

    assert rsa.sign(message) == signature

@pytest.mark.parametrize("message", [
    "Hello, World!",
    "Test message",
    "Another test message",
    "RSA is great!",
    "Python is awesome!"
])
def test_verify_signature(message):
    rsa = RSA(prime_bit_length=512)
    rsa.generate_primes()
    rsa.generate_public_key()
    rsa.generate_private_key()

    signature = rsa.sign(message)
    assert rsa.verify_signature(message, signature) == True